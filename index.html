<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Nomi Manager</title>
    
    <link rel="manifest" href="manifest.json">
    
    <link rel="icon" type="image/svg+xml" href="logo.svg">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Nomi Manager">
    <link rel="apple-touch-icon" href="logo.svg">
    <meta name="theme-color" content="#0f0f13">

    <link rel="stylesheet" href="./styles.css">
    <link rel="stylesheet" href="./chat.css">
    <script defer src="./theme.js"></script>
    <script defer src="./app.js"></script>
    <script defer src="./chat.js"></script>

</head>
<body>

<div id="lightbox" class="lightbox" onclick="app.closeLightbox()">
    <span class="lightbox-close">&times;</span>
    <img class="lightbox-content" id="lightboxImg">
</div>

<div class="global-prompt-popup" id="globalPromptPopup" onclick="event.stopPropagation()">
    <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
        <strong style="color:var(--accent);">Edit Prompt</strong>
        <span style="cursor:pointer; font-size:1.2rem;" onclick="app.closePromptPopup()">âœ•</span>
    </div>
    <textarea id="globalPromptInput" placeholder="Enter prompt here..."></textarea>
    <div class="btn-row" style="margin-top:0;">
        <div style="display:flex; gap:10px;">
            <button class="save-btn" onclick="app.savePromptManual()">Save</button>
            <button class="copy-btn" style="color:var(--error); border-color:var(--error); background: transparent;" onclick="app.closePromptPopup()">Cancel</button>
        </div>
        <div style="display:flex; gap:10px;">
            <button class="copy-btn" onclick="app.pasteText('globalPromptInput')">Paste</button>
            <button class="copy-btn" onclick="app.copyText('globalPromptInput')">Copy</button>
        </div>
    </div>
</div>

<div id="contextMenu" class="context-menu" onclick="event.stopPropagation()"></div>

<div id="globalInputPopup" class="global-input-popup" onclick="event.stopPropagation()">
    <h3 style="margin:0; color:var(--accent);">Rename</h3>
    <input type="text" id="globalRenameInput" class="settings-input-group" style="width:100%; margin:0; padding:10px; background:var(--bg-input); border:1px solid var(--border); color:var(--text-main); border-radius:6px;" onkeydown="if(event.key==='Enter') app.confirmRename()">
    <div style="display:flex; justify-content:flex-end; gap:10px;">
        <button class="btn-secondary" style="margin:0; width:auto;" onclick="document.getElementById('globalInputPopup').classList.remove('active')">Cancel</button>
        <button class="save-btn" onclick="app.confirmRename()">Save</button>
    </div>
</div>

<input type="file" id="contextUpload" style="display:none;" accept="image/*" onchange="cropper.init(this, 'context')">

<div id="cropModal" class="crop-modal">
    <div class="crop-container" id="cropContainer" 
         onmousedown="cropper.startDrag(event)" 
         ontouchstart="cropper.startDrag(event)"
         onwheel="cropper.handleWheel(event)">
        
        <img id="cropTarget" class="crop-image" draggable="false">
        <div id="cropGuide" class="circle-guide"></div>
    </div>
    <div class="crop-controls">
        <span>Zoom:</span>
        <input type="range" min="0.1" max="1.5" step="0.01" value="1" class="crop-slider" id="cropZoom" oninput="cropper.setZoom(this.value)">
    </div>
    <div class="crop-btns">
        <button class="btn-secondary" style="margin:0;" onclick="cropper.cancel()">Cancel</button>
        <button class="save-btn" onclick="cropper.save()">Set</button>
    </div>
</div>

<div id="imageOptionModal" class="image-option-modal" onclick="if(event.target===this) this.classList.remove('active')">
    <div class="image-option-panel">
        <h3 style="margin:0;color:var(--accent)">Set Image As...</h3>
        <button class="image-option-btn" onclick="app.confirmImageSet('profile')">Profile Picture</button>
        <button class="btn-secondary" onclick="document.getElementById('imageOptionModal').classList.remove('active')">Cancel</button>
    </div>
</div>

<div id="settingsModal" class="settings-modal" onclick="if(event.target === this) app.toggleSettings()">
    <div class="settings-panel">
        <div class="settings-header">
            <h2>Settings</h2>
            <span class="settings-close" onclick="app.toggleSettings()">Ã—</span>
        </div>
        
        <div class="settings-body">
            <div class="settings-card">
                <h3>Integrations</h3>
                <span class="settings-label">Nomi.ai API Key</span>
                <div class="settings-input-group">
                    <input type="password" id="apiKeyInput" readonly placeholder="xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx">
                    <button class="input-edit-btn" onclick="app.toggleEdit('apiKeyInput', this, 'apiKey')">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20h9"></path><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path></svg>
                    </button>
                </div>
                <button class="btn-secondary" style="width:100%; display:flex; align-items:center; justify-content:center; gap:8px;" onclick="app.syncFromApi()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                    Import from Nomi.ai
                </button>
            </div>

            <div class="settings-card">
                <h3>
                    Cloud Sync (GitHub Gist) 
                    <button class="icon-btn" onclick="app.toggleCloudHelp()" title="Help" style="width:24px; height:24px; font-size:0.8rem; background:transparent;">?</button>
                </h3>
                
                <div style="margin-bottom:15px; display:flex; align-items:center; gap:10px;">
                    <input type="checkbox" id="cloudSyncCheck" style="width:18px; height:18px; accent-color:var(--accent);" onchange="app.toggleCloudSync(this.checked)">
                    <label for="cloudSyncCheck" style="cursor:pointer; font-size:0.9rem;">Enable Auto-Sync</label>
                </div>

                <span class="settings-label">GitHub Token</span>
                <div class="settings-input-group">
                    <input type="password" id="ghTokenInput" readonly placeholder="ghp_xxxxxxxxxxxx...">
                    <button class="input-edit-btn" onclick="app.toggleEdit('ghTokenInput', this, 'ghToken')">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20h9"></path><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path></svg>
                    </button>
                </div>

                <span class="settings-label">Gist ID (nomi-data.json)</span>
                <div class="settings-input-group">
                    <input type="password" id="gistIdInput" readonly placeholder="e.g. 8f7d...">
                    <button class="input-edit-btn" onclick="app.toggleEdit('gistIdInput', this, 'gistId')">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20h9"></path><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path></svg>
                    </button>
                </div>

                <div style="display:flex; gap:10px; margin-bottom:15px; justify-content:center;">
                    <button class="tool-text-btn" onclick="app.exportCloudCreds()">Export Keys</button>
                    <button class="tool-text-btn" onclick="document.getElementById('importKeysFile').click()">Import Keys</button>
                </div>

                <div style="display:flex; gap:10px;">
                    <button class="btn-secondary" onclick="app.cloudUpload()" style="flex:1;">Upload</button>
                    <button class="btn-secondary" onclick="app.cloudDownload()" style="flex:1;">Download</button>
                </div>
            </div>

            <div class="settings-card">
                <h3>Appearance</h3>
                <div class="settings-row">
                    <span class="settings-row-label">App Theme</span>
                    <select id="themeSelect" class="select-input" style="width:60%;" onchange="app.setTheme(this.value)">
                        <option value="midnight">Midnight (Default)</option>
                        <option value="paper">Paper (Light)</option>
                        <option value="oled">OLED (True Black)</option>
                        <option value="terminal">Terminal</option>
                    </select>
                </div>
                <div class="settings-row">
                    <span class="settings-row-label">Start-Up View</span>
                    <select id="startUpSelect" class="select-input" style="width:60%;" onchange="app.saveSetting('startView', this.value)">
                        <option value="home">Dashboard</option>
                        <option value="last">Last Visited Page</option>
                    </select>
                </div>
            </div>

            <div class="settings-card">
                <h3>Local Data</h3>
                
                <div class="storage-viz-container">
                    <div class="storage-bar-header">
                        <span>Storage Usage</span>
                        <div class="storage-bar-legend">
                            <div class="legend-item"><div class="legend-dot nomi"></div>Nomis</div>
                            <div class="legend-item"><div class="legend-dot group"></div>Groups</div>
                        </div>
                    </div>
                    <div class="storage-bar">
                        <div id="barNomis" class="storage-bar-seg nomi" style="width:0%"></div>
                        <div id="barGroups" class="storage-bar-seg group" style="width:0%"></div>
                    </div>
                </div>

                <div class="storage-grid">
                    <div class="storage-stat-box">
                        <span class="stat-val" id="statTotalImages">0</span>
                        <span class="stat-lbl">Total Images</span>
                    </div>
                    <div class="storage-stat-box">
                        <span class="stat-val" id="statTotalNomis">0</span>
                        <span class="stat-lbl">Total Nomis</span>
                    </div>
                    <div class="storage-stat-box">
                        <span class="stat-val" id="statStorageUsed">0 MB</span>
                        <span class="stat-lbl">Storage Used</span>
                    </div>
                </div>

                <div class="storage-list">
                    <div style="font-size:0.8rem; font-weight:bold; color:var(--text-muted); margin-bottom:5px;">TOP 3 LARGEST PROFILES</div>
                    <div id="storageTopList"></div>
                </div>

                <div style="height:1px; background:var(--border); margin:20px 0;"></div>

                <button class="btn-secondary" id="btnOptimize" onclick="app.optimizeStorage()" style="width:100%; margin-top:0; margin-bottom:10px; border-color:var(--accent); color:var(--accent);">
                    Optimize Storage (Compress Images)
                </button>
                <div style="display:flex; gap:10px;">
                    <button class="btn-secondary" onclick="app.exportData()" style="flex:1;">Backup (File)</button>
                    <button class="btn-secondary" onclick="document.getElementById('importFile').click()" style="flex:1;">Restore (File)</button>
                </div>
                <div style="height:1px; background:var(--border); margin:20px 0;"></div>

                <div style="background:rgba(239, 68, 68, 0.1); border:1px solid var(--error); border-radius:8px; padding:15px; text-align:center;">
                    <p style="margin:0 0 10px 0; color:var(--error); font-size:0.8rem; font-weight:bold;">DANGER ZONE</p>
                    <p style="margin:0 0 15px 0; color:var(--text-muted); font-size:0.8rem;">Permanently delete all Nomis, Groups, and Images stored in this browser.</p>
                    <button class="delete-btn" onclick="app.deleteAllData()" style="margin:0; width:100%; font-size:0.9rem; padding:10px;">Delete Everything</button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="cloudHelpModal" class="settings-modal" onclick="if(event.target === this) app.toggleCloudHelp()">
    <div class="settings-panel" style="max-width:500px; width:90%; max-height:85vh; display:flex; flex-direction:column;">
        
        <div class="settings-header" style="flex-shrink:0;">
            <h2>Cloud Sync Setup</h2>
            <span class="settings-close" onclick="app.toggleCloudHelp()">Ã—</span>
        </div>
        
        <div style="padding:20px; line-height:1.5; color:var(--text-muted); font-size:0.9rem; overflow-y:auto;">
            <p style="margin-top:0;">To sync data between devices, Nomi Manager uses a free <strong>GitHub Gist</strong> as your private cloud storage.</p>
            
            <h3 style="color:var(--text-main); margin:15px 0 10px 0; font-size:1rem;">Step 1: Get a Token</h3>
            <ol style="padding-left:20px; margin:0;">
                <li>Log in to GitHub.</li>
                <li>Go to <strong>Settings > Developer Settings > Personal Access Tokens (Classic)</strong>.</li>
                <li>Click <strong>Generate New Token (Classic)</strong>.</li>
                <li>Note: "Nomi App".</li>
                <li><strong>Scopes:</strong> Check the box for <strong>gist</strong>.</li>
                <li>Generate and Copy the token (starts with <code style="word-break:break-all;">ghp_...</code>).</li>
            </ol>

            <h3 style="color:var(--text-main); margin:15px 0 10px 0; font-size:1rem;">Step 2: Create the File</h3>
            <ol style="padding-left:20px; margin:0;">
                <li>Go to <strong>gist.github.com</strong>.</li>
                <li>Description: "Nomi Data".</li>
                <li>Filename: <strong>nomi-data.json</strong>.</li>
                <li>Content: Type <code>{}</code> (curly braces).</li>
                <li>Click <strong>Create Secret Gist</strong>.</li>
                <li>Copy the <strong>Gist ID</strong> from the URL.</li>
            </ol>
            
            <div style="margin-top:20px; padding:12px; background:var(--bg-input); border-radius:8px; font-size:0.85rem;">
                <strong>Tip:</strong> Once setup, use <strong>"Export Keys"</strong> to save a file to easily import on other devices!
            </div>
        </div>
        
        <div style="padding:15px; border-top:1px solid var(--border); flex-shrink:0;">
            <button class="btn-secondary" style="width:100%; margin:0;" onclick="app.toggleCloudHelp()">Close</button>
        </div>
    </div>
</div>

<div class="fab-group" id="fabGroup">
  <div class="fab-actions">
    <!-- Slide-up menu -->
    <div class="sync-menu" id="syncMenu" aria-hidden="true">
      <button class="sync-menu-btn" type="button" onclick="app.cloudDownload(); app.closeSyncMenu();">
        Download
      </button>
      <button class="sync-menu-btn" type="button" onclick="app.cloudUpload(); app.closeSyncMenu();">
        Upload
      </button>
    </div>

    <!-- Sync pill (does NOT move; click opens the menu) -->
    <div class="sync-pill" id="syncBtn" onclick="app.toggleSyncMenu(event)">
      <span id="syncText" class="sync-text">Syncing...</span>
      <svg id="syncIcon" xmlns="http://www.w3.org/2000/svg" width="24" height="24"
           viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
           stroke-linecap="round" stroke-linejoin="round">
        <path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2"/>
      </svg>
    </div>

    <!-- Settings button -->
    <div class="fab-btn" id="settingsBtn" onclick="app.toggleSettings()">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
           viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
           stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="3"></circle>
        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83
                 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33
                 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2
                 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4
                 a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0
                 2 2 0 0 1 0-2.83l.06-.06A1.65 1.65 0 0 0 4.6 15
                 a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2
                 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9
                 a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83
                 2 2 0 0 1 2.83 0l.06.06A1.65 1.65 0 0 0 9 4.6
                 a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2
                 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51
                 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0
                 2 2 0 0 1 0 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9
                 a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2
                 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
      </svg>
    </div>
  </div>
</div>


<div class="main-content">
    <div id="heroBackground" class="hero-bg"></div>

    <div id="viewHome">
        <div class="top-bar">
            <h2>
                <img src="logo.svg" class="app-logo" style="width:32px; height:32px;">
                Nomi Manager
            </h2>
            <div class="search-wrapper">
                <div class="view-toggles">
                    <button class="view-btn active" id="btnViewGrid" onclick="app.setDashboardView('grid')">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg>
                    </button>
                    <button class="view-btn" id="btnViewList" onclick="app.setDashboardView('list')">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></svg>
                    </button>
                </div>
                <div class="view-toggles" style="margin-left: 8px;">
                    <button class="view-btn" id="btnDashboardArrange" onclick="app.toggleDashboardReorder()" title="Reorder dashboard">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="9" cy="6" r="1"/><circle cx="9" cy="12" r="1"/><circle cx="9" cy="18" r="1"/>
                            <circle cx="15" cy="6" r="1"/><circle cx="15" cy="12" r="1"/><circle cx="15" cy="18" r="1"/>
                        </svg>
                    </button>
                    <button class="view-btn" id="btnDashboardReset" onclick="app.resetDashboardOrder()" title="Reset dashboard order" style="display:none;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M3 12a9 9 0 1 0 3-6.7"/><path d="M3 3v6h6"/>
                        </svg>
                    </button>

                </div>
                <input type="text" class="search-input" id="searchInput" placeholder="Search..." oninput="app.renderGallery()">
                <button class="search-icon-btn" onclick="document.getElementById('searchInput').classList.toggle('active'); document.getElementById('searchInput').focus();">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                </button>
            </div>
        </div>

        <div class="section-divider">
            <span>My Nomis</span>
            <button class="btn-action" style="font-size:0.8rem; padding: 5px 10px;" onclick="app.createNomi()">+ Create</button>
        </div>
        <div class="gallery-grid" id="nomiGallery"></div>
        
        <div class="section-divider">
            <span>Groups</span>
            <button class="btn-action" style="font-size:0.8rem; padding: 5px 10px;" onclick="app.createGroup()">+ Create</button>
        </div>
        <div class="gallery-grid" id="groupGallery"></div>
    </div>

    <div id="viewNomi" style="display:none;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; position:relative; z-index:20;">
            <button class="back-btn" onclick="app.goHome()">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M19 12H5"/><path d="M12 19l-7-7 7-7"/></svg>
            </button>
        </div>
        
        <div class="profile-header-card">
            <div class="profile-avatar-wrapper clickable" onclick="document.getElementById('nomiPhotoInput').click()">
                <img id="nomiImageDisplay" src="" style="display:none;">
                <div id="nomiImagePlaceholder" class="placeholder">?</div>
                <input type="file" id="nomiPhotoInput" accept="image/*" style="display:none;" onchange="cropper.init(this, 'nomi')">
            </div>
            <div class="profile-info">
                <div class="profile-name-row">
                    <div id="nomiNameDisplay" class="profile-name">Name</div>
                    <button id="nomiEditBtn" class="icon-btn" onclick="app.toggleNameEdit('nomi', true)">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path></svg>
                    </button>
                        <div id="nomiNameEdit" class="name-edit-container">
                            <input type="text" class="profile-name-input" id="nomiName" placeholder="Name" maxlength="30" onkeydown="if(event.key==='Enter') app.saveName('nomi')">
                            <button class="icon-btn save" onclick="app.saveName('nomi')"><svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg></button>
                            <button class="icon-btn" onclick="app.cancelNameEdit('nomi')" style="color:#ef4444;"><svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>
                        </div>
                    </div>
                <div class="traits-row">
                    <span class="traits-header">Traits <button class="add-trait-btn" onclick="document.getElementById('traitInput').style.display='block';document.getElementById('traitInput').focus()">+</button></span>
                    <input type="text" id="traitInput" placeholder="Add..." maxlength="20" style="width:80px; display:none;">
                    <div class="tag-container" id="traitContainer" style="margin:0;"></div>
                </div>
            </div>
        </div>
        
        <div class="tab-nav">
            <div class="tab-left">
                <button class="tab-btn active" id="tabProfile" onclick="app.switchTab('profile')">Profile Data</button>
                <button class="tab-btn" id="tabGallery" onclick="app.switchTab('gallery')">Gallery</button>
            </div>
        </div>

        <div id="contentProfile">
            <div class="gallery-toolbar" id="expandTools">
            <div class="tools-left">
                <button class="tool-btn" onclick="app.copyAllSections(false)" title="Copy All Sections"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path><rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect></svg></button>
                <button class="tool-btn" id="btnSortNomi" onclick="app.toggleReorderMode()" title="Sort / Reorder"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7 15l5 5 5-5"/><path d="M7 9l5-5 5 5"/></svg></button>
                <button class="tool-btn" id="btnResetNomi" onclick="app.resetSort()" title="Reset Order" style="visibility:hidden;"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="1 4 1 10 7 10"/><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/></svg></button>
            </div>
            <div class="tools-right">
                <button class="tool-text-btn" onclick="app.setAllSections(false)">â–¼ Expand</button>
                <button class="tool-text-btn" onclick="app.setAllSections(true)">â–² Collapse</button>
            </div>
        </div>
            <div class="form-column-container" id="profileGrid"></div>
            <button class="btn-add-section" onclick="app.addNomiSection()">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                Add Custom Section
            </button>
            <button class="delete-btn" onclick="app.deleteNomi()">Delete Nomi</button>
        </div>
        
        <div id="contentGallery" style="display:none;">
            <div class="gallery-toolbar">
                <input type="text" class="gallery-search" id="nomiGallerySearch" placeholder="Search prompts..." oninput="app.filterGallery(this.value)">
                
                <div class="gallery-tools-right">
                    <button class="tool-btn" title="Sort Order" onclick="app.toggleGallerySort()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18H3M21 6H3M17 12H3"/></svg>
                    </button>
                    <div style="position:relative;">
                        <button class="tool-btn hide-mobile" title="Grid Size" onclick="app.toggleGridMenu(this)">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg>
                        </button>
                        <div class="grid-menu" onclick="event.stopPropagation()">
                            <div class="grid-slider-row">
                                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M4 4h4v4H4zM10 4h4v4h-4zM16 4h4v4h-4zM4 10h4v4H4zM10 10h4v4h-4zM16 10h4v4h-4zM4 16h4v4H4zM10 16h4v4h-4zM16 16h4v4h-4zM4 16h4v4h-4z"/></svg>
                                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M4 4h7v7H4zM13 4h7v7h-7zM13 13h7v7h-7zM4 13h7v7H4z"/></svg>
                                <svg viewBox="0 0 24 24" fill="currentColor"><rect x="4" y="4" width="16" height="16" rx="2"/></svg>
                                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M2 2h20v20H2z"/></svg>
                            </div>
                            <input type="range" class="custom-slider" min="0" max="3" step="1" value="1" oninput="app.setGallerySize(this.value)">
                        </div>
                    </div>
                    <button class="tool-btn" title="Show/Hide Prompts" onclick="app.toggleShowPrompts()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                    </button>
                    
                    <button class="tool-btn" id="btnBatchMode" title="Batch Select Mode" onclick="app.toggleBatchMode()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
                    </button>
                    <button class="tool-btn del" id="btnBatchDelete" title="Delete Selected" style="display:none;" onclick="app.deleteBatchImages()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2-2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
                    </button>
                    <button class="btn-upload" style="background:var(--bg-card); border:1px solid var(--border); color:var(--text-main);" onclick="app.pasteGalleryImage()">Paste from Clipboard</button>
                    <button class="btn-upload" onclick="document.getElementById('galleryUpload').click()">Upload</button>
                    <input type="file" id="galleryUpload" accept="image/*" multiple style="display:none" onchange="app.addGalleryImages(this)">
                </div>
            </div>
            <div class="masonry-grid" id="promptGalleryGrid"></div>
        </div>
    </div>

    <div id="viewGroup" style="display:none;">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; position:relative; z-index:20;">
            <button class="back-btn" onclick="app.goHome()">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M19 12H5"/><path d="M12 19l-7-7 7-7"/></svg>
            </button>
        </div>
        
        <div class="profile-header-card">
            <div class="profile-avatar-wrapper clickable" onclick="document.getElementById('groupPhotoInput').click()">
                <img id="groupImageDisplay" src="" style="display:none;">
                <div id="groupImagePlaceholder" class="placeholder">G</div>
                <input type="file" id="groupPhotoInput" accept="image/*" style="display:none;" onchange="cropper.init(this, 'group')">
            </div>
            <div class="profile-info">
                <div class="profile-name-row">
                    <div id="groupNameDisplay" class="profile-name">Group Name</div>
                    <button id="groupEditBtn" class="icon-btn" onclick="app.toggleNameEdit('group', true)">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path></svg>
                    </button>
                        <div id="groupNameEdit" class="name-edit-container">
                            <input type="text" class="profile-name-input" id="groupName" placeholder="Group Name" maxlength="50" onkeydown="if(event.key==='Enter') app.saveName('group')">
                            <button class="icon-btn save" onclick="app.saveName('group')"><svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg></button>
                            <button class="icon-btn" onclick="app.cancelNameEdit('group')" style="color:#ef4444;"><svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button>
                        </div>
                    </div>
            </div>
        </div>
        
        <div class="tab-nav">
             <div class="tab-left">
                <button class="tab-btn active" id="tabGroupProfile" onclick="app.switchGroupTab('profile')">Group Data</button>
                <button class="tab-btn" id="tabGroupMembers" onclick="app.switchGroupTab('members')">Members</button>
                <button class="tab-btn" id="tabGroupGallery" onclick="app.switchGroupTab('gallery')">Gallery</button>
            </div>
        </div>
        
        <div id="contentGroupProfile">
            <div class="gallery-toolbar" id="groupExpandTools">
             <div class="tools-left">
                <button class="tool-btn" onclick="app.copyAllSections(true)" title="Copy All Sections"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path><rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect></svg></button>
                <button class="tool-btn" id="btnSortGroup" onclick="app.toggleReorderMode()" title="Sort / Reorder"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7 15l5 5 5-5"/><path d="M7 9l5-5 5 5"/></svg></button>
                <button class="tool-btn" id="btnResetGroup" onclick="app.resetSort()" title="Reset Order" style="visibility:hidden;"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="1 4 1 10 7 10"/><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/></svg></button>
             </div>
             <div class="tools-right">
                <button class="tool-text-btn" onclick="app.setAllSections(false)">â–¼ Expand</button>
                <button class="tool-text-btn" onclick="app.setAllSections(true)">â–² Collapse</button>
             </div>
        </div>
            <div id="groupSectionsContainer" class="form-column-container"></div>
            
            <button class="btn-add-section" onclick="app.addGroupSection()">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                Add Custom Section
            </button>
            <button class="delete-btn" onclick="app.deleteGroup()">Delete Group</button>
        </div>

        <div id="contentGroupMembers" style="display:none;">
             <div class="custom-select-wrapper" id="memberDropdownWrapper">
                <div class="custom-select-trigger" onclick="app.toggleMemberDropdown()">+ Add Member</div>
                <div class="custom-options" id="memberOptions"></div>
            </div>
            <div id="groupMembersGrid" class="member-grid"></div>
        </div>

        <div id="contentGroupGallery" style="display:none;">
            <div class="gallery-toolbar">
                <input type="text" class="gallery-search" id="groupGallerySearch" placeholder="Search prompts..." oninput="app.filterGallery(this.value)">
                
                <div class="gallery-tools-right">
                    <button class="tool-btn" title="Sort Order" onclick="app.toggleGallerySort()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18H3M21 6H3M17 12H3"/></svg>
                    </button>
                    <div style="position:relative;">
                        <button class="tool-btn hide-mobile" title="Grid Size" onclick="app.toggleGridMenu(this)">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg>
                        </button>
                        <div class="grid-menu" onclick="event.stopPropagation()">
                            <div class="grid-slider-row">
                                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M4 4h4v4H4zM10 4h4v4h-4zM16 4h4v4h-4zM4 10h4v4H4zM10 10h4v4h-4zM16 10h4v4h-4zM4 16h4v4H4zM10 16h4v4h-4zM16 16h4v4h-4zM4 16h4v4h-4z"/></svg>
                                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M4 4h7v7H4zM13 4h7v7h-7zM13 13h7v7h-7zM4 13h7v7H4z"/></svg>
                                <svg viewBox="0 0 24 24" fill="currentColor"><rect x="4" y="4" width="16" height="16" rx="2"/></svg>
                                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M2 2h20v20H2z"/></svg>
                            </div>
                            <input type="range" class="custom-slider" min="0" max="3" step="1" value="1" oninput="app.setGallerySize(this.value)">
                        </div>
                    </div>
                    <button class="tool-btn" title="Show/Hide Prompts" onclick="app.toggleShowPrompts()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                    </button>
                    
                    <button class="tool-btn" id="btnBatchMode" title="Batch Select Mode" onclick="app.toggleBatchMode()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
                    </button>
                    <button class="tool-btn del" id="btnBatchDelete" title="Delete Selected" style="display:none;" onclick="app.deleteBatchImages()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2-2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
                    </button>
                    <button class="btn-upload" style="background:var(--bg-card); border:1px solid var(--border); color:var(--text-main);" onclick="app.pasteGalleryImage()">Paste from Clipboard</button>
                    <button class="btn-upload" onclick="document.getElementById('groupGalleryUpload').click()">Upload</button>
                    <input type="file" id="groupGalleryUpload" accept="image/*" multiple style="display:none" onchange="app.addGalleryImages(this)">
                </div>
            </div>
            <div class="masonry-grid" id="groupPromptGalleryGrid"></div>
        </div>
    </div>

</div>

<input type="file" id="importFile" style="display:none" onchange="app.importData(this)">
<input type="file" id="importKeysFile" style="display:none" onchange="app.importCloudCreds(this)">
<input type="file" id="bannerUpload" style="display:none" accept="image/*" onchange="cropper.init(this, 'banner')">

<div class="toast" id="toast" role="status" aria-live="polite" aria-atomic="true">Saved Successfully!</div>


<div id="mobileBackdrop" onclick="app.closeAllMenus()"></div>

<!-- CHAT MODAL -->
<div id="chatModal" class="chat-modal">
    <div class="chat-container">
        <!-- Chat Sidebar -->
        <div class="chat-sidebar" id="chatSidebar">
            <div class="chat-sidebar-header">
                <h2>Chats</h2>
                <button class="chat-close-btn" onclick="chatManager.closeChat()">Ã—</button>
            </div>
            
            <div class="chat-tabs">
                <button class="chat-tab active" data-tab="nomis" onclick="chatManager.switchTab('nomis')">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
                    Chats
                </button>
                <button class="chat-tab" data-tab="rooms" onclick="chatManager.switchTab('rooms')">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
                    Rooms
                </button>
            </div>

            <!-- Nomis List -->
            <div class="chat-list" id="nomisList" style="display:block;">
                <!-- Populated by chatManager.renderNomisList() -->
            </div>

            <!-- Rooms List -->
            <div class="chat-list" id="roomsList" style="display:none;">
                <button class="chat-new-room-btn" onclick="chatManager.showNewRoomModal()">
                    <span>+</span> New Room
                </button>
                <!-- Populated by chatManager.renderRoomsList() -->
            </div>
        </div>

        <!-- Chat Main Area -->
        <div class="chat-main" id="chatMain">
            <div class="chat-welcome">
                <div class="chat-welcome-icon">ðŸ’¬</div>
                <h3>Select a chat to start messaging</h3>
                <p>Choose a Nomi for 1-on-1 chat or create a room for group conversations</p>
            </div>
        </div>
    </div>
</div>

<div id="newRoomModal" class="new-room-modal" onclick="if(event.target===this) chatManager.closeNewRoomModal()">
    <div class="new-room-panel">
        <div class="new-room-header">
            <h3>Create New Room</h3>
            <button class="new-room-close" onclick="chatManager.closeNewRoomModal()">Ã—</button>
        </div>
        
        <div class="new-room-body">
            <div class="room-photo-wrapper">
                <div class="room-photo-upload" onclick="document.getElementById('newRoomPhotoInput').click()">
                    <img id="newRoomPhotoPreview" class="room-photo-preview">
                    <span id="newRoomPhotoPlaceholder" class="room-photo-placeholder">+</span>
                </div>
                <input type="file" id="newRoomPhotoInput" hidden accept="image/*" onchange="chatManager.handleRoomPhoto(this, 'new')">
            </div>

            <label>Room Name</label>
            <input type="text" id="newRoomName" placeholder="Enter room name..." class="new-room-input">

            <label>Note (Optional)</label>
            <textarea id="newRoomNote" placeholder="Room backstory or context..." class="new-room-textarea"></textarea>

            <div style="margin: 10px 0; display: flex; align-items: center; gap: 10px;">
                <input type="checkbox" id="newRoomBackchannel" checked style="width: 20px; height: 20px; accent-color: var(--accent);">
                <label for="newRoomBackchannel" style="margin:0; cursor:pointer;">Enable Backchanneling (Nomis talk to each other)</label>
            </div>
            <label>Select Nomis (at least 1 required)</label>
            <div id="newRoomNomisList" class="new-room-nomis-list"></div>
        </div>

        <div class="new-room-footer">
            <button class="btn-secondary" onclick="chatManager.closeNewRoomModal()">Cancel</button>
            <button class="save-btn" onclick="chatManager.createRoom()">Create Room</button>
        </div>
    </div>
</div>

<!-- Edit Room Modal -->
<div id="editRoomModal" class="new-room-modal" onclick="if(event.target===this) chatManager.closeEditRoomModal()">
    <div class="new-room-panel">
        <div class="new-room-header">
            <h3>Edit Room</h3>
            <button class="new-room-close" onclick="chatManager.closeEditRoomModal()">Ã—</button>
        </div>
        
        <div class="new-room-body">
            <div class="room-photo-wrapper">
                <div class="room-photo-upload" onclick="document.getElementById('editRoomPhotoInput').click()">
                    <img id="editRoomPhotoPreview" class="room-photo-preview">
                    <span id="editRoomPhotoPlaceholder" class="room-photo-placeholder">+</span>
                </div>
                <input type="file" id="editRoomPhotoInput" hidden accept="image/*" onchange="chatManager.handleRoomPhoto(this, 'edit')">
            </div>

            <label>Room Name</label>
            <input type="text" id="editRoomName" placeholder="Enter room name..." class="new-room-input">

            <label>Note</label>
            <textarea id="editRoomNote" placeholder="Room backstory or context..." class="new-room-textarea"></textarea>

            <div style="margin: 10px 0; display: flex; align-items: center; gap: 10px;">
                <input type="checkbox" id="editRoomBackchannel" style="width: 20px; height: 20px; accent-color: var(--accent);">
                <label for="editRoomBackchannel" style="margin:0; cursor:pointer;">Enable Backchanneling (1-on-1 Context)</label>
            </div>
            <label>Nomis in Room</label>
            <div id="editRoomNomisList" class="new-room-nomis-list"></div>
        </div>
        
        <div class="new-room-footer">
            <button class="btn-secondary" style="color:var(--error); border-color:var(--error);" onclick="chatManager.deleteRoom()">Delete Room</button>
            <div style="display:flex; gap:10px;">
                <button class="btn-secondary" onclick="chatManager.closeEditRoomModal()">Cancel</button>
                <button class="save-btn" onclick="chatManager.updateRoom()">Save Changes</button>
            </div>
        </div>
    </div>
</div>
    
<button class="fab-chat" onclick="chatManager.openChat()" title="Open Chat">
    <div id="chatTotalBadge" class="fab-badge" style="display:none;">0</div>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
</button>

<div id="chatNotification" class="chat-notification-toast" onclick="chatManager.openFromNotification();">
    <img id="notifAvatar" class="chat-notification-avatar" src="logo.svg">
    <div class="chat-notification-content">
        <div id="notifTitle" class="chat-notification-title">Nomi</div>
        <div class="chat-notification-text">New message received</div>
    </div>
</div>

</body>
</html>



